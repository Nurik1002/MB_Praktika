{% extends 'base.html' %}
{% load static %}

{% block title %}My patients{% endblock title %}

{% block content %}
    <h1>Create Consultation</h1>
   <div>
        <form action="" method="POST">
            {% csrf_token %}

            <input type="text" name="title" placeholder="Title" required>
            <br>
            <br>
            <input type="text" name="desctription" placeholder="Desctription" required>
            <br>
            <br>
            <select name="doctors" id="doctors"></select>
            
            
            <button type="submit">Send request</button>
        </form>
   </div>

{% endblock content %}

{% block script %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script type="text/javascript">
    $("#createConsultationForm").submit(function(event) {
    event.preventDefault();
    var formData = new FormData(this); 

    $.ajax({
        url: '/ajax/create/consultation/',
        method: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
          
            console.log(response.message);
        },
        error: function(error) {
       
            console.error(error);
        }
    });
});


$(document).ready(function(){
    var url = "/ajax/get/doctors/"
    function getDoctors(){
        $.ajax({
            url: url,
            type: "GET",
            dataType: "json",
            headers: {
                "Accept": "application/json"
            },
            timeout: 1000,
            success: function(response){
                var doctorsList = $("#doctors");
                doctorsList.empty();
                if (response.data.length > 0){
                    console.log(response.data);
                    $.each(response.data,  function(index, data){
                        var doctorItem = `
                        <option value='${data.doctor_id}'>
                            ${ data.doctor_fullname }  ${data.doctor_spec}
                        </option>
                        `
                        doctorsList.append(doctorItem);
                    })
                }

            }
        })
    }
    getDoctors()
    setInterval(getDoctors, 100000);
}); 
</script>
{% endblock script %}